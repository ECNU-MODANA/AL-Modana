<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_2.dtd'>
<nta>
	<declaration>// Place global declarations here.
const int N = 2;         // # obstacle
typedef int[0,N-1] id_t; //# 障碍物id
broadcast chan  NOISE; //# 噪声信号
broadcast chan SAFE[N]; //# 障碍物发出安全信号
bool DANGER[N]; // # 障碍物处于危险区域
bool COLLISION[N]; //# 障碍物处于碰撞区域
id_t currentOb; // 当前障碍物id
clock c;//# robot能耗时钟
double v; //# 机器人运动速度
double e;//# robot能耗变量
</declaration>
	<template>
		<name x="5" y="5">robot</name>
		<declaration>// Place local declarations here.
clock T;//# robot时钟
const double m = 1.0; //# 机器人质量
const double g = 10.0; //# 重力加速度
const double a = 0.3; //# 机器人加速度 
const double u = 0.8; //# 摩擦系数 </declaration>
		<location id="id0" x="-3063" y="-2482">
			<name x="-3097" y="-2516">Collide</name>
		</location>
		<location id="id1" x="-2612" y="-2805">
			<name x="-2603" y="-2839">Wait</name>
			<label kind="invariant" x="-2655" y="-2788">T&lt;=20 &amp;&amp; c'==0</label>
		</location>
		<location id="id2" x="-2842" y="-2482">
			<name x="-2852" y="-2516">final</name>
		</location>
		<location id="id3" x="-3000" y="-2567">
			<name x="-3080" y="-2592">CrossPoint</name>
			<committed/>
		</location>
		<location id="id4" x="-2596" y="-2601">
			<name x="-2587" y="-2617">Dsafe1s</name>
			<label kind="invariant" x="-2604" y="-2592">T&lt;=10&amp;&amp;c'==e/100</label>
		</location>
		<location id="id5" x="-2876" y="-2728">
			<name x="-2936" y="-2753">Dsafe1u</name>
			<label kind="invariant" x="-2953" y="-2720">T&lt;=7&amp;&amp;c'==e/100</label>
		</location>
		<location id="id6" x="-2799" y="-2864">
			<name x="-2850" y="-2898">Dsafe1st</name>
			<label kind="invariant" x="-2850" y="-2915">T&lt;=6&amp;&amp;c'==e/100</label>
		</location>
		<location id="id7" x="-3012" y="-2907">
			<name x="-3022" y="-2941">S1</name>
			<label kind="invariant" x="-3054" y="-2958">T&lt;=30&amp;&amp;c'==e/100</label>
		</location>
		<location id="id8" x="-3301" y="-2907">
			<name x="-3326" y="-2941">Start</name>
			<urgent/>
		</location>
		<init ref="id8"/>
		<transition>
			<source ref="id3"/>
			<target ref="id0"/>
			<label kind="guard" x="-3165" y="-2541">COLLISION[currentOb]==true</label>
		</transition>
		<transition>
			<source ref="id3"/>
			<target ref="id7"/>
			<label kind="guard" x="-3241" y="-2796">currentOb&lt;(N-1) &amp;&amp; COLLISION[currentOb]==false</label>
			<label kind="assignment" x="-3199" y="-2779">currentOb++</label>
		</transition>
		<transition>
			<source ref="id1"/>
			<target ref="id1"/>
			<label kind="assignment" x="-2536" y="-2813">T:=0</label>
			<nail x="-2536" y="-2830"/>
			<nail x="-2544" y="-2779"/>
		</transition>
		<transition>
			<source ref="id1"/>
			<target ref="id4"/>
			<label kind="synchronisation" x="-2629" y="-2745">NOISE?</label>
			<label kind="assignment" x="-2723" y="-2652">T:=0,e:=1/2*m*v*v-1/2*m*(v-a*10)*(v-a*10)+m*g*u*(v*v-(v-a*10)*(v-a*10))/2*a,
v:=v-a*10</label>
		</transition>
		<transition>
			<source ref="id1"/>
			<target ref="id3"/>
			<label kind="synchronisation" x="-2816" y="-2728">SAFE[currentOb]?</label>
			<label kind="assignment" x="-2782" y="-2703">T:=0</label>
		</transition>
		<transition>
			<source ref="id6"/>
			<target ref="id1"/>
			<label kind="guard" x="-2765" y="-2864">T&gt;=6 &amp;&amp; DANGER[currentOb]==true</label>
			<label kind="assignment" x="-2790" y="-2894">T:=0</label>
		</transition>
		<transition>
			<source ref="id4"/>
			<target ref="id3"/>
			<label kind="guard" x="-2799" y="-2609">T&gt;=10</label>
			<label kind="assignment" x="-2791" y="-2592">T:=0</label>
		</transition>
		<transition>
			<source ref="id5"/>
			<target ref="id3"/>
			<label kind="guard" x="-2961" y="-2686">T&gt;=7</label>
			<label kind="assignment" x="-2961" y="-2669">T:=0</label>
		</transition>
		<transition>
			<source ref="id6"/>
			<target ref="id5"/>
			<label kind="guard" x="-2944" y="-2813">T&gt;=6&amp;&amp;DANGER[currentOb]==false</label>
			<label kind="assignment" x="-2885" y="-2788">T:=0,e:=m*g*7*v*u</label>
		</transition>
		<transition>
			<source ref="id3"/>
			<target ref="id2"/>
			<label kind="guard" x="-2952" y="-2533">currentOb==N-1</label>
		</transition>
		<transition>
			<source ref="id7"/>
			<target ref="id6"/>
			<label kind="guard" x="-2944" y="-2907">T&gt;=2</label>
			<label kind="assignment" x="-2970" y="-2890">T:=0,e:=m*g*6*v*u</label>
		</transition>
		<transition>
			<source ref="id8"/>
			<target ref="id7"/>
			<label kind="assignment" x="-3293" y="-2890">currentOb:=0,v:=10.0,e:=m*g*u*2*v+1/2*m*v*v</label>
		</transition>
	</template>
	<template>
		<name>obstacle</name>
		<parameter>const id_t id</parameter>
		<declaration>// Place local declarations here.
clock t; //# 障碍物运动时钟</declaration>
		<location id="id9" x="-4420" y="-4012">
			<name x="-4437" y="-4046">final</name>
		</location>
		<location id="id10" x="-4301" y="-4012">
			<name x="-4311" y="-4046">After</name>
			<label kind="invariant" x="-4311" y="-3995">t&lt;=14</label>
		</location>
		<location id="id11" x="-4054" y="-4122">
			<name x="-4063" y="-4105">Dout</name>
			<label kind="invariant" x="-4062" y="-4088">t&lt;=8</label>
		</location>
		<location id="id12" x="-4258" y="-4190">
			<name x="-4268" y="-4224">Din</name>
			<label kind="invariant" x="-4268" y="-4181">t&lt;=6</label>
		</location>
		<location id="id13" x="-4420" y="-4190">
			<name x="-4445" y="-4224">Before</name>
			<label kind="invariant" x="-4430" y="-4173">t&lt;=30</label>
		</location>
		<location id="id14" x="-4556" y="-4106">
			<name x="-4590" y="-4132">start</name>
			<urgent/>
		</location>
		<init ref="id14"/>
		<transition>
			<source ref="id12"/>
			<target ref="id11"/>
			<label kind="guard" x="-4241" y="-4207">t&gt;=6</label>
			<label kind="assignment" x="-4199" y="-4173">t:=0,COLLISION[id]:=true</label>
			<nail x="-4139" y="-4173"/>
		</transition>
		<transition>
			<source ref="id10"/>
			<target ref="id9"/>
			<label kind="guard" x="-4377" y="-4046">t&gt;=14</label>
			<label kind="assignment" x="-4369" y="-4029">t:=0</label>
		</transition>
		<transition>
			<source ref="id11"/>
			<target ref="id10"/>
			<label kind="guard" x="-4046" y="-4037">t&gt;=8</label>
			<label kind="synchronisation" x="-4139" y="-4037">SAFE[id]!</label>
			<label kind="assignment" x="-4241" y="-4012">t:=0,DANGER[id]:=false,COLLISION[id]:=false</label>
			<nail x="-4054" y="-4012"/>
		</transition>
		<transition>
			<source ref="id13"/>
			<target ref="id12"/>
			<label kind="guard" x="-4403" y="-4216">t&gt;=2</label>
			<label kind="assignment" x="-4352" y="-4190">t:=0</label>
		</transition>
		<transition>
			<source ref="id14"/>
			<target ref="id13"/>
			<label kind="assignment" x="-4538" y="-4144">DANGER[id]:=true</label>
		</transition>
	</template>
	<template>
		<name>noise</name>
		<declaration>// Place local declarations here.
clock n; //# 噪声信号时钟</declaration>
		<location id="id15" x="-7497" y="-5924">
			<name x="-7523" y="-5959">idle</name>
			<label kind="invariant" x="-7548" y="-5933">n&lt;=2</label>
			<label kind="exponentialrate" x="-7523" y="-5916">0.01</label>
		</location>
		<init ref="id15"/>
		<transition>
			<source ref="id15"/>
			<target ref="id15"/>
			<label kind="synchronisation" x="-7455" y="-5949">NOISE!</label>
			<label kind="assignment" x="-7446" y="-5932">n:=0</label>
			<nail x="-7370" y="-5941"/>
			<nail x="-7370" y="-5864"/>
			<nail x="-7429" y="-5890"/>
		</transition>
	</template>
	<system>// Place template instantiations here.
// List one or more processes to be composed into a system.
system robot,obstacle,noise;
    </system>
	<queries>
		<query>
			<formula>Pr[&lt;=100] (&lt;&gt; e&gt;=500)
			</formula>
			<comment>
			</comment>
		</query>
		<query>
			<formula>Pr[&lt;=100] (&lt;&gt; robot.Collide)
			</formula>
			<comment>
			</comment>
		</query>
		<query>
			<formula>simulate 1 [&lt;=100]{T}
			</formula>
			<comment>
			</comment>
		</query>
		<query>
			<formula>simulate 1 [&lt;=100]{c,robot.T,e,v,robot.S1,robot.Dsafe1st,robot.Wait,robot.Dsafe1u,robot.Dsafe1s,robot.CrossPoint,robot.Collide,robot.final,noise.idle}
			</formula>
			<comment>
			</comment>
		</query>
	</queries>
</nta>
